---

copyright:
  years: 2017, 2018
lastupdated: "2018-05-14"

---

{:new_window: target="_blank"}
{:shortdesc: .shortdesc}
{:pre: .pre}
{:tip: .tip}


# Storing and accessing user profiles
{: #user-profile}

With {{site.data.keyword.appid_full}}, you can build personalized app experiences by accessing the information about your users that is automatically stored by app id.
{: shortdesc}

A user profile is a collection of attributes that are stored by app id. Attributes are pieces of information about the users that interact with your app. There are two types that can be obtained: `user` and `custom`. A user attribute is returned as a token from an identity provider when a user signs into your app. The token can include their name, age, gender, or other publicly available information. Custom attributes are learned about your users as they interact with your app. This might be their preferred language, the font size the use, or even items that they have placed in a shopping cart.


![{{site.data.keyword.appid_short_notm}} user profile architecture](/images/user-profile.png)

There are three different ways in which you can access user information. User attributes are available through an identity token and the `/userinfo` endpoint. The API endpoint is a resource that is protected by the access token that is generated by {{site.data.keyword.appid_short_notm}} during the login and authorization process. To see custom attributes, you can use the <a href="https://appid-profiles.ng.bluemix.net/swagger-ui/index.html#/Attributes" target="_blank">REST API <img src="../../icons/launch-glyph.svg" alt="External link icon"></a>.

## Understanding identity tokens
{: #identity}

When sign-in occurs with an [identity provider](/docs/services/appid/identity-providers.html), information about the user is returned as part of an identity token. Identity tokens represent authentication and contain information about the user such as their name, gender, or location. The service takes that raw identity provider data and normalizes it to return a profile. Other data is stored in the raw form, but can be accessed through the `userinfo` endpoint.

Typically, the returned information takes the following form:

```
// Normalized Profile
{
    "name": "John Doe",
    "email": "john.doe@gmail.com",
    "picture": "https://lh3.googleusercontent.com/-XdUIqdbhg/AAAAAAAAI/AAAAAAA/42rbcbv5M/photo.jpg",
    "gender": "male",
    "locale": "en",
}
```
{: screen}

<table>
  <thead>
    <th colspan=2><img src="images/idea.png" alt="Idea icon"/> Understanding the components</th>
  </thead>
  <tbody>
    <tr>
      <td><code><em>name</em></code></td>
      <td>The user's full name, in a displayable form.</td>
    </tr>
    <tr>
      <td><code><em>email</em></code></td>
      <td>The user's email address.</td>
    </tr>
    <tr>
      <td><code><em>picture</em></code></td>
      <td>A link to the user's profile picture.</td>
    </tr>
    <tr>
      <td><code><em>gender</em></code></td>
      <td>The user's gender as specified by the identity provider.</td>
    </tr>
    <tr>
      <td><code><em>locale</em></code></td>
      <td>The user's location.</td>
    </tr>
  </tbody>
</table>



## Accessing additional user information
{: #accessing}

You can view custom or identity provider specific information about your users by using the protected `/userinfo` endpoint.
{: shortdesc}

To view the additional information:

1. Be sure that you have a valid access token with an `openid` scope. You can verify that your token is valid by using the `/introspect` endpoint.

2. Make a request to the `/userinfo` endpoint.
  ```
  GET [POST] https://{oauth-server-endpoint}/userinfo
  Authorization: 'Bearer {ACCESS_TOKEN}'
  ```
  {: pre}

  Example output:
  ```
  "sub": "cad9f1d4-e23b-3683-b81b-d1c4c4fd7d4c",
  "name": "John Doe",
  "email": "john.doe@gmail.com",
  "picture": "https://lh3.googleusercontent.com/-XdUIqdbhg/AAAAAAAAI/AAAAAAA/42rbcbv5M/photo.jpg",
  "gender": "male",
  "locale": "en",
  "identities": [
      {
          "provider": "google",
          "id": "104560903311317789798",
          "profile": {
              "id": "104560903311317789798",
              "email": "john.doe@gmail.com",
              "verified_email": true,
              "name": "John Doe",
              "given_name": "John",
              "family_name": "Doe",
              "link": "https://plus.google.com/104560903311317789798",
              "picture": "https://lh3.googleusercontent.com/-XdUIqdbhg/AAAAAAAAI/AAAAAAA/42rbcbv5M/photo.jpg",
              "gender": "male",
              "locale": "en",
              "idpType": "google"
          }
      }
  ]
  ```
  {: screen}

3. Verify that the `sub` claim exactly matches the `sub` claim in the identity token. If these do not match, do not use the returned information. To learn more about token substitution, see the <a href="http://openid.net/specs/openid-connect-core-1_0.html#TokenSubstitution" target="blank">OIDC specification <img src="../../icons/launch-glyph.svg" alt="External link icon"></a>.

If changes are made by an external identity provider, you can get the updated information when your users log in again. Your new tokens retrieve the most up-to-date data.
{: tip}



## Accessing user attributes
{: #accessing}

When you obtain an access token, it is possible to gain access to the user protected attributes endpoint.
{: shortdesc}

{{site.data.keyword.appid_short_notm}} provides a <a href="https://appid-profiles.ng.bluemix.net/swagger-ui/index.html#/Attributes" target="blank">REST API <img src="../../icons/launch-glyph.svg" alt="External link icon"></a> that allows log in, either anonymously or by authenticating, with a supported [identity provider](/docs/services/appid/identity-providers.html). The API endpoint is a resource that is protected by the access token that is generated by {{site.data.keyword.appid_short_notm}} during the login and authorization process.



**Accessing user attributes with the Android SDK**

```java
void setAttribute(@NonNull String name, @NonNull String value, UserAttributeResponseListener listener);
void setAttribute(@NonNull String name, @NonNull String value, @NonNull AccessToken accessToken, UserAttributeResponseListener listener);

void getAttribute(@NonNull String name, UserAttributeResponseListener listener);
void getAttribute(@NonNull String name, @NonNull AccessToken accessToken, UserAttributeResponseListener listener);

void deleteAttribute(@NonNull String name, UserAttributeResponseListener listener);
void deleteAttribute(@NonNull String name, @NonNull AccessToken accessToken, UserAttributeResponseListener listener);

void getAllAttributes(@NonNull UserAttributeResponseListener listener);
void getAllAttributes(@NonNull AccessToken accessToken, @NonNull UserAttributeResponseListener listener);
```
{: pre}

When an access token is not explicitly passed, {{site.data.keyword.appid_short_notm}} uses the last received token.

For example, you can call the following code to set a new attribute, or override an existing one.

  ```java
  appId.getUserAttributeManager().setAttribute(name, value, useThisToken,new UserAttributeResponseListener() {
		@Override
		public void onSuccess(JSONObject attributes) {
			//attributes received in JSON format on successful response
		}

		@Override
		public void onFailure(UserAttributesException e) {
			//Exception occurred
		}
	});
  ```
  {: pre}

For more information about working in Android, check out the <a href="https://github.com/ibm-cloud-security/appid-clientsdk-android" target="blank">SDK <img src="../../icons/launch-glyph.svg" alt="External link icon"></a>.
{: tip}



**Accessing user attributes with the iOS SDK**

Access to the users attributes by passing an access token through the following API methods.

  ```swift
  func setAttribute(key: String, value: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)
  func setAttribute(key: String, value: String, accessTokenString: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)

  func getAttribute(key: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)
  func getAttribute(key: String, accessTokenString: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)

  func getAttributes(completionHandler: @escaping(Error?, [String:Any]?) -> Void)
  func getAttributes(accessTokenString: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)

  func deleteAttribute(key: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)
  func deleteAttribute(key: String, accessTokenString: String, completionHandler: @escaping(Error?, [String:Any]?) -> Void)
  ```
  {: pre}

When an access token is not explicitly passed, {{site.data.keyword.appid_short_notm}} uses the last received token.

For example, you can call the following code to set a new attribute, or override an existing one.

  ```swift
  AppID.sharedInstance.userAttributeManager?.setAttribute("key", "value", completionHandler: { (error, result) in
      if error = nil {
          //Attributes recieved as a Dictionary
      } else {
          // An error has occurred
      }
  })
  ```
  {: pre}

  For more information about working in iOS Swift, check out the <a href="https://github.com/ibm-cloud-security/appid-clientsdk-swift" target="blank">SDK <img src="../../icons/launch-glyph.svg" alt="External link icon"></a>.
  {: tip}
